<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- ZERO ZOOM / FIT TO SCREEN CONFIGURATION -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Broadcast Center | Epoch19 Admin</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* --- 1. ADMIN THEME VARIABLES --- */
        :root {
            --bg-deep: #020617;
            --admin-primary: #7C3AED;
            --admin-accent: #8B5CF6;
            --ai-gradient: linear-gradient(135deg, #3B82F6 0%, #8B5CF6 100%);
            --text-main: #F8FAFC;
            --text-muted: #94A3B8;
            --glass-surface: rgba(15, 23, 42, 0.95);
            --glass-border: rgba(139, 92, 246, 0.3);
            --font-ui: 'Inter', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-ui);
            background-color: var(--bg-deep);
            color: var(--text-main);
            min-height: 100vh;
            display: flex; flex-direction: column;
            overflow-x: hidden; /* Prevent horizontal scroll */
            width: 100vw;
        }

        /* --- 2. BACKGROUND --- */
        .bg-wrapper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -5;
            background: linear-gradient(135deg, #020617 0%, #0f172a 100%);
        }
        @media (min-width: 768px) {
            .bg-wrapper {
                background: linear-gradient(to bottom, rgba(2, 6, 23, 0.85), rgba(2, 6, 23, 0.95)), url('assets/images/background.png');
                background-size: cover; background-attachment: fixed;
            }
        }

        /* --- 3. NAVIGATION --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000;
            padding: 1rem 5%; background: rgba(2, 6, 23, 0.98);
            border-bottom: 1px solid var(--admin-primary);
            display: flex; justify-content: space-between; align-items: center;
            height: 70px; /* Fixed height for calculations */
        }
        .brand {
            display: flex; align-items: center; gap: 12px; font-weight: 700; font-size: 1.1rem; color: #fff; text-decoration: none;
        }
        .admin-badge {
            background: var(--admin-primary); color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.7rem; font-weight: 700;
        }
        .menu-toggle { font-size: 1.8rem; cursor: pointer; color: var(--text-muted); }

        .nav-drawer {
            position: fixed; top: 0; right: -300px; width: 280px; height: 100vh;
            background: #0f172a; border-left: 1px solid var(--admin-primary);
            z-index: 1001; padding: 6rem 2rem; transition: right 0.3s ease;
            display: flex; flex-direction: column; gap: 1rem;
        }
        .nav-drawer.active { right: 0; }
        .nav-item {
            text-decoration: none; color: var(--text-muted); font-size: 1rem;
            display: flex; align-items: center; gap: 15px; padding: 12px;
            border-radius: 6px; transition: 0.3s;
        }
        .nav-item:hover, .nav-item.active {
            background: rgba(124, 58, 237, 0.1); color: #fff; border: 1px solid var(--admin-primary);
        }
        .nav-close { position: absolute; top: 20px; right: 20px; font-size: 2rem; cursor: pointer; }

        /* --- 4. MAIN LAYOUT (FIT TO SCREEN LOGIC) --- */
        main {
            margin-top: 70px; /* Match header height */
            padding: 2rem 5%; 
            flex: 1; 
            width: 100%;
            max-width: 1600px; /* Allow wider screens */
            align-self: center;
            display: grid; 
            grid-template-columns: 1.5fr 1fr; /* Desktop Ratio */
            gap: 2rem;
        }

        /* --- AI PANEL --- */
        .ai-panel {
            background: linear-gradient(180deg, rgba(59, 130, 246, 0.1) 0%, rgba(15, 23, 42, 0) 100%);
            border: 1px solid rgba(59, 130, 246, 0.4);
            border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;
            position: relative; overflow: hidden;
            width: 100%;
        }
        .ai-panel::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: var(--ai-gradient); animation: ai-scan 3s infinite linear;
        }
        .ai-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 10px; }
        .ai-title { font-family: var(--font-code); color: #60A5FA; font-size: 0.9rem; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }
        
        .ai-input-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .ai-input {
            flex: 1; min-width: 200px; /* Ensure input is visible on mobile */
            background: rgba(0,0,0,0.5); border: 1px solid #3B82F6;
            color: #fff; padding: 12px 15px; border-radius: 6px; outline: none;
            font-family: var(--font-ui);
        }
        .btn-ai {
            background: var(--ai-gradient); border: none; padding: 12px 20px;
            color: #fff; border-radius: 6px; cursor: pointer; font-weight: 600;
            display: flex; align-items: center; gap: 8px; transition: 0.3s;
            white-space: nowrap; flex-shrink: 0;
        }
        .btn-ai:hover { box-shadow: 0 0 15px rgba(59, 130, 246, 0.4); }

        /* --- EDITOR PANEL --- */
        .editor-panel {
            background: var(--glass-surface); border: 1px solid var(--glass-border);
            border-radius: 12px; padding: 2rem; backdrop-filter: blur(10px);
            width: 100%;
        }
        .form-group { margin-bottom: 1.5rem; width: 100%; }
        .form-label { display: block; margin-bottom: 0.5rem; color: var(--text-muted); font-size: 0.85rem; }
        
        .form-input, .form-textarea {
            width: 100%; padding: 12px; background: rgba(0,0,0,0.4);
            border: 1px solid var(--glass-border); border-radius: 8px;
            color: #fff; font-family: var(--font-ui); outline: none; transition: 0.3s;
            max-width: 100%; /* Prevent overflow */
        }
        .form-input:focus, .form-textarea:focus { border-color: var(--admin-primary); }
        .form-textarea { height: 150px; resize: vertical; line-height: 1.6; }
        
        /* Type Selector */
        .type-selector { display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
        .type-option { flex: 1; position: relative; min-width: 100px; }
        .type-option input { position: absolute; opacity: 0; cursor: pointer; width:100%; height:100%; z-index: 2; }
        .type-card {
            background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border);
            border-radius: 8px; padding: 1rem; text-align: center; transition: 0.3s;
            display: flex; flex-direction: column; align-items: center; gap: 8px;
            height: 100%; justify-content: center;
        }
        .type-option input:checked + .type-card {
            background: rgba(124, 58, 237, 0.15); border-color: var(--admin-primary);
        }

        .btn-publish {
            width: 100%; padding: 14px; background: var(--admin-primary);
            color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 700;
            cursor: pointer; transition: 0.3s; display: flex; justify-content: center; align-items: center; gap: 8px;
        }
        .btn-publish:hover { background: var(--admin-accent); }

        /* --- PREVIEW PANEL (SMART POSITIONING) --- */
        .preview-panel { 
            position: sticky; 
            top: 100px; /* Sticky on Desktop */
            height: fit-content; 
            width: 100%;
        }
        .res-card {
            background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(16px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 0;
            overflow: hidden; border-top: 4px solid #3B82F6;
        }
        .res-img-container {
            width: 100%; height: 180px; background: #0f172a; position: relative; overflow: hidden;
        }
        .res-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .res-content { padding: 1.8rem; position: relative; }
        .res-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem; color: #fff; word-wrap: break-word; }
        .res-summary { font-size: 0.9rem; color: var(--text-muted); line-height: 1.6; margin-bottom: 1.5rem; word-wrap: break-word; }
        .btn-action {
            padding: 10px 20px; background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;
            color: #3B82F6; font-weight: 600; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 8px;
        }

        @keyframes ai-scan { 0% { left: -100%; } 100% { left: 100%; } }

        /* --- MOBILE & TABLET OPTIMIZATION (THE "NOTHING HIDDEN" FIX) --- */
        @media(max-width: 1024px) { 
            main { 
                grid-template-columns: 1fr; /* Stack into 1 column */
                gap: 2rem;
                padding: 1.5rem 1rem; /* Less padding on mobile */
            }
            .preview-panel {
                position: relative; /* Remove sticky on mobile so it doesn't get stuck */
                top: 0;
                margin-top: 1rem;
            }
            .type-selector { gap: 0.5rem; }
            .type-option { min-width: 48%; } /* 2 per row on mobile */
            .editor-panel { padding: 1.5rem 1rem; }
        }

        footer {
            margin-top: auto; border-top: 1px solid var(--glass-border);
            padding: 1.5rem 5%; background: rgba(2, 6, 23, 0.95);
            font-size: 0.8rem; color: var(--text-muted);
            text-align: center;
        }
    </style>
</head>
<body>

    <div class="bg-wrapper"></div>

    <header>
        <a href="admin-dashboard.html" class="brand">
            <img src="assets/images/logo.png" alt="Epoch19" style="height: 30px;">
            <span>EPOCH19 <span class="admin-badge">ADMIN</span></span>
        </a>
        <i class='bx bx-menu menu-toggle' onclick="toggleNav()"></i>
    </header>

    <aside class="nav-drawer" id="navDrawer">
        <i class='bx bx-x nav-close' onclick="toggleNav()"></i>
        <a href="admin-dashboard.html" class="nav-item"><i class='bx bxs-dashboard'></i> Overview</a>
        <a href="admin-data.html" class="nav-item"><i class='bx bx-table'></i> Data Manager</a>
        <a href="admin-payments.html" class="nav-item"><i class='bx bx-credit-card'></i> Payments</a>
        <a href="admin-resources.html" class="nav-item active"><i class='bx bx-news'></i> Post Resources</a>
        <a href="admin-settings.html" class="nav-item"><i class='bx bx-slider-alt'></i> Global Config</a>
        <div style="margin-top: auto;">
            <a href="dashboard.html" class="nav-item"><i class='bx bx-arrow-back'></i> User View</a>
            <a href="#" class="nav-item" id="btn-logout" style="color: #EF4444;"><i class='bx bx-power-off'></i> Logout</a>
        </div>
    </aside>

    <main>
        
        <!-- LEFT COLUMN: INPUTS -->
        <div>
            <!-- AI GENERATOR -->
            <div class="ai-panel">
                <div class="ai-header">
                    <div class="ai-title"><i class='bx bx-chip'></i> EPOCH19 AI CORE</div>
                    <div style="font-size: 0.7rem; color: #60A5FA;">V 2.4.0 BETA</div>
                </div>
                <div class="ai-input-group">
                    <input type="text" class="ai-input" id="ai-topic" placeholder="Enter topic (e.g., 'Cybersecurity', 'Climate')">
                    <button class="btn-ai" onclick="generateAIContent()">
                        <i class='bx bxs-magic-wand'></i> AUTO-WRITE
                    </button>
                </div>
            </div>

            <!-- MANUAL FORM -->
            <div class="editor-panel">
                <div class="form-label">Resource Type</div>
                <div class="type-selector">
                    <label class="type-option">
                        <input type="radio" name="resType" value="article" checked onchange="updatePreview()">
                        <div class="type-card"><i class='bx bx-world'></i><span>News</span></div>
                    </label>
                    <label class="type-option">
                        <input type="radio" name="resType" value="pdf" onchange="updatePreview()">
                        <div class="type-card"><i class='bx bx-file-pdf'></i><span>PDF</span></div>
                    </label>
                    <label class="type-option">
                        <input type="radio" name="resType" value="alert" onchange="updatePreview()">
                        <div class="type-card"><i class='bx bx-error-circle'></i><span>Alert</span></div>
                    </label>
                </div>

                <form id="resource-form">
                    <div class="form-group">
                        <label class="form-label">Headline Title</label>
                        <input type="text" class="form-input" id="inp-title" placeholder="Title..." required oninput="updatePreview()">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Cover Image URL (AI Generated)</label>
                        <input type="url" class="form-input" id="inp-img" placeholder="https://..." required oninput="updatePreview()">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Full Content / Summary</label>
                        <textarea class="form-textarea" id="inp-summary" placeholder="Content..." required oninput="updatePreview()"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">External Link (Optional)</label>
                        <input type="url" class="form-input" id="inp-url" placeholder="https://..." value="https://epoch19.com/news">
                    </div>

                    <button type="submit" class="btn-publish" id="btn-submit">
                        <i class='bx bx-broadcast'></i> Broadcast to Network
                    </button>
                </form>
            </div>
        </div>

        <!-- RIGHT COLUMN: PREVIEW (Stacks on mobile) -->
        <div class="preview-panel" id="preview-wrapper">
            <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 10px; font-weight: 700;">LIVE PREVIEW</div>
            
            <div class="res-card">
                <div class="res-img-container">
                    <img src="assets/images/placeholder.jpg" class="res-img" id="prev-img" onerror="this.src='https://via.placeholder.com/400x200/0f172a/94a3b8?text=EPOCH19'">
                </div>
                <div class="res-content">
                    <div style="display:flex; justify-content:space-between; color: var(--text-muted); font-size: 0.8rem; margin-bottom:10px;">
                        <span><i class='bx bx-calendar'></i> Just Now</span>
                        <span style="color:#EF4444; font-weight:700;">NEW</span>
                    </div>
                    <div class="res-title" id="prev-title">Headline Title</div>
                    <div class="res-summary" id="prev-summary">Content description will appear here...</div>
                    <div class="btn-action" id="prev-btn">
                        Read Full Article <i class='bx bx-right-arrow-alt'></i>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        Epoch19 Admin System &copy; 2025
    </footer>

    <!-- LOGIC -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDlWM9hfnreQMAXze5q5o2jr_Z9ekYxE2M",
            authDomain: "epoch19-479ca.firebaseapp.com",
            projectId: "epoch19-479ca",
            storageBucket: "epoch19-479ca.firebasestorage.app",
            messagingSenderId: "608813445980",
            appId: "1:608813445980:web:08ab4dedc8ddc71e670799",
            measurementId: "G-JKR6K20LSL"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // 1. Auth Guard
        onAuthStateChanged(auth, async (user) => {
            if (!user) { window.location.href = "login.html"; return; }
            const userDoc = await getDoc(doc(db, "users", user.uid));
            if (!userDoc.exists() || userDoc.data().role !== 'admin') {
                window.location.href = "dashboard.html";
            }
        });

        // 2. AI ENGINE LOGIC
        window.generateAIContent = async () => {
            const topic = document.getElementById('ai-topic').value;
            if (!topic) { Swal.fire('Error', 'Please enter a topic first.', 'warning'); return; }

            const btn = document.querySelector('.btn-ai');
            const originalText = btn.innerHTML;
            
            // Step 1: Visual "Thinking" Process
            btn.disabled = true;
            btn.innerHTML = `<i class='bx bx-loader-alt bx-spin'></i> THINKING...`;
            await wait(800);
            
            btn.innerHTML = `<i class='bx bx-network-chart bx-flashing'></i> SEARCHING...`;
            await wait(800);
            
            btn.innerHTML = `<i class='bx bx-pencil bx-tada'></i> WRITING...`;
            await wait(1000);

            // Step 2: Content Generation (Heuristic)
            const currentDate = new Date().toLocaleDateString();
            const keywords = topic.split(' ');
            const mainKw = keywords[0].charAt(0).toUpperCase() + keywords[0].slice(1);

            const generatedTitle = `Comprehensive Report: The State of ${topic.toUpperCase()} in ${new Date().getFullYear()}`;
            
            const generatedContent = `
In an era defined by rapid technological shifts and global interconnectivity, the subject of ${topic} has emerged as a critical focal point for industry leaders and policymakers alike. As of ${currentDate}, data suggests a paradigm shift in how we approach ${mainKw}, driven largely by unforeseen market variables and evolving consumer behaviors.

Our latest Epoch19 analysis indicates that ${topic} is no longer a peripheral concern but a core component of sustainable development. Experts argue that failing to adapt to these changes could result in significant systemic inefficiencies. "The integration of advanced methodologies in ${topic} is paramount," states Dr. Aris Thorne, Lead Analyst at the Global Data Consortium.

Furthermore, statistics reveal a 40% increase in engagement surrounding ${topic}-related initiatives over the last quarter. This report delves deep into the mechanisms driving this trend, offering a granular view of the challenges and opportunities that lie ahead. By leveraging predictive modeling, we can anticipate that ${topic} will continue to shape the socioeconomic landscape for the next decade.

In conclusion, stakeholders must prioritize agility and data-driven decision-making to navigate the complexities of ${topic}. This article outlines five key strategies for optimizing performance in this volatile sector.
            `.trim();

            // Step 3: Image Generation
            const generatedImage = `https://source.unsplash.com/1600x900/?${encodeURIComponent(topic)},technology`;

            // Step 4: Populate Form
            document.getElementById('inp-title').value = generatedTitle;
            document.getElementById('inp-summary').value = generatedContent;
            document.getElementById('inp-img').value = generatedImage;
            
            updatePreview();

            btn.innerHTML = `<i class='bx bx-check'></i> DONE`;
            btn.disabled = false;
            setTimeout(() => { btn.innerHTML = originalText; }, 3000);

            Swal.fire({
                toast: true, position: 'top-end', icon: 'success', 
                title: 'AI Content Generated', background: '#020617', color:'#fff', timer: 2000, showConfirmButton: false
            });
        };

        const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        // 3. Preview Logic
        window.updatePreview = () => {
            const title = document.getElementById('inp-title').value || "Headline Title";
            const summary = document.getElementById('inp-summary').value || "Content description...";
            const imgUrl = document.getElementById('inp-img').value;
            const type = document.querySelector('input[name="resType"]:checked').value;
            
            const prevTitle = document.getElementById('prev-title');
            const prevSummary = document.getElementById('prev-summary');
            const prevImg = document.getElementById('prev-img');
            const prevBtn = document.getElementById('prev-btn');

            prevTitle.innerText = title;
            prevSummary.innerText = summary.length > 100 ? summary.substring(0, 100) + "..." : summary;
            if(imgUrl) prevImg.src = imgUrl;

            // Type Styles
            if (type === 'pdf') {
                document.querySelector('.res-card').style.borderTopColor = '#EF4444';
                prevBtn.innerHTML = `Download PDF <i class='bx bx-download'></i>`;
                prevBtn.style.color = '#EF4444';
            } else if (type === 'alert') {
                document.querySelector('.res-card').style.borderTopColor = '#F59E0B';
                prevBtn.innerHTML = `View Alert <i class='bx bx-error'></i>`;
                prevBtn.style.color = '#F59E0B';
            } else {
                document.querySelector('.res-card').style.borderTopColor = '#3B82F6';
                prevBtn.innerHTML = `Read Full Article <i class='bx bx-right-arrow-alt'></i>`;
                prevBtn.style.color = '#3B82F6';
            }
        };

        // 4. Submit
        document.getElementById('resource-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-submit');
            btn.innerHTML = `<i class='bx bx-loader-alt bx-spin'></i> Transmitting...`;
            btn.disabled = true;

            try {
                await addDoc(collection(db, "resources"), {
                    title: document.getElementById('inp-title').value,
                    content: document.getElementById('inp-summary').value,
                    imageUrl: document.getElementById('inp-img').value,
                    link: document.getElementById('inp-url').value,
                    type: document.querySelector('input[name="resType"]:checked').value,
                    createdAt: serverTimestamp()
                });
                
                Swal.fire({ icon: 'success', title: 'Broadcast Sent', background: '#020617', color:'#fff', timer: 1500, showConfirmButton:false });
                e.target.reset();
                updatePreview();
            } catch (err) {
                console.error(err);
                Swal.fire('Error', err.message, 'error');
            } finally {
                btn.innerHTML = `<i class='bx bx-broadcast'></i> Broadcast to Network`;
                btn.disabled = false;
            }
        });

        window.toggleNav = () => document.getElementById('navDrawer').classList.toggle('active');
        document.getElementById('btn-logout').addEventListener('click', () => {
            signOut(auth).then(() => window.location.href = "index.html");
        });
    </script>
</body>
</html>
